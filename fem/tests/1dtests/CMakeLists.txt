
INCLUDE(${CMAKE_CURRENT_SOURCE_DIR}/../test_macros.cmake)

INCLUDE_DIRECTORIES(${CMAKE_BINARY_DIR}/fem/src)

ADD_LIBRARY(Poisson MODULE Poisson.f90)
ADD_LIBRARY(Source MODULE Source.f90)
SET_TARGET_PROPERTIES(Poisson PROPERTIES PREFIX "")
SET_TARGET_PROPERTIES(Source PROPERTIES PREFIX "")

ADD_DEPENDENCIES(Poisson elmersolver ElmerSolver_mpi ElmerGrid)
ADD_DEPENDENCIES(Source elmersolver ElmerSolver_mpi ElmerGrid)

IF(APPLE)
  TARGET_LINK_LIBRARIES(Poisson elmersolver)
  TARGET_LINK_LIBRARIES(Source elmersolver)
ENDIF()

IF(CMAKE_SYSTEM_NAME STREQUAL "Windows")
  TARGET_LINK_LIBRARIES(Poisson elmersolver)
  TARGET_LINK_LIBRARIES(Source elmersolver)
ENDIF()

CONFIGURE_FILE(ELMERSOLVER_STARTINFO ELMERSOLVER_STARTINFO COPYONLY)
CONFIGURE_FILE(1d.grd 1d.grd COPYONLY)
CONFIGURE_FILE(1d.sif 1d.sif COPYONLY)

ADD_ELMER_TEST(Poisson)
