SET(ElmerIceUtils_SRC ProjUtils.F90 SSAMaterialModels.F90 ComputeFluxUtils.F90 PorousMaterialModels.F90)

ADD_LIBRARY(ElmerIceUtils SHARED ${ElmerIceUtils_SRC})

IF(HAVE_PROJ)
  INCLUDE_DIRECTORIES(${PROJ_INCLUDE_DIR})
  INCLUDE_DIRECTORIES(${FORTRANGIS_INCLUDE_DIR})
  TARGET_LINK_LIBRARIES(ElmerIceUtils ${PROJ_LIBRARY})
  TARGET_LINK_LIBRARIES(ElmerIceUtils ${FORTRANGIS_LIBRARY})
ENDIF()

# Library object
SET_TARGET_PROPERTIES(ElmerIceUtils PROPERTIES PREFIX "")
SET_TARGET_PROPERTIES(ElmerIceUtils PROPERTIES LINKER_LANGUAGE Fortran)
IF(NOT(WIN32))
    SET_TARGET_PROPERTIES(ElmerIceUtils PROPERTIES
                          INSTALL_RPATH "${ELMERSOLVER_RPATH_STRING};${ELMER_SOLVER_HOME}/lib/")
    SET_TARGET_PROPERTIES(ElmerIceUtils PROPERTIES
                          INSTALL_RPATH_USE_LINK_PATH TRUE)
ENDIF()

TARGET_LINK_LIBRARIES(ElmerIceUtils Elmer::MPI_Fortran elmersolver)

INSTALL(TARGETS ElmerIceUtils LIBRARY DESTINATION "share/elmersolver/lib"
        RUNTIME DESTINATION "share/elmersolver/lib")
