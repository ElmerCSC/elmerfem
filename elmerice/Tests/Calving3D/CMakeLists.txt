INCLUDE(${CMAKE_CURRENT_SOURCE_DIR}/../test_macros.cmake)

CONFIGURE_FILE(calving3d.sif calving3d.sif COPYONLY)

ADD_ELMERICETEST_MODULE(Calving3D bedrockfunction_3d ./PROG/bedrockfunction_3D.F90)
ADD_ELMERICETEST_MODULE(Calving3D DummySolver ./PROG/DummySolver.F90)

FILE(COPY ELMERSOLVER_STARTINFO PlanMesh.msh PROG DESTINATION "${CMAKE_CURRENT_BINARY_DIR}/")

FILE(MAKE_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}/Results/PlanMesh")
FILE(MAKE_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}/Results/isoline")
FILE(MAKE_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}/Results/calving_plane")

IF(WITH_MPI)
  # Check the task bounds and add only compatible tests
  SET(NPROCS 4)
  IF(${NPROCS} GREATER ${MPI_TEST_MAXPROC} OR ${NPROCS} LESS ${MPI_TEST_MINPROC})
    MESSAGE(STATUS "Skipping test Calving3D with ${NPROCS} procs")
  ELSE()
    ADD_ELMERICE_TEST(Calving3D)
    ADD_ELMERICE_LABEL(Calving3D slow)
  ENDIF()
ENDIF()
