SET(CMAKE_Fortran_MODULE_DIRECTORY
  ${PROJECT_BINARY_DIR}/fmodules CACHE PATH "Directory for Fortran modules")

#FIND_PACKAGE(PHDF5)

SET(FNAME GridDataReader.F90)
GET_FILENAME_COMPONENT(BASENAME ${FNAME} NAME_WE)

ADD_LIBRARY(${BASENAME} SHARED ${FNAME})
TARGET_LINK_LIBRARIES(${BASENAME} Elmer::MPI_Fortran)

INCLUDE_DIRECTORIES(${NETCDF_INCLUDE_DIR})
IF(PHDF5_FOUND)
INCLUDE_DIRECTORIES(${PHDF5_INCLUDE_DIR})
TARGET_LINK_LIBRARIES(${BASENAME} ${NETCDF_LIBRARIES} ${PHDF5_LIBRARIES} elmersolver)
ELSE()
TARGET_LINK_LIBRARIES(${BASENAME} ${NETCDF_LIBRARIES} elmersolver)
ENDIF()

# Library object
SET_TARGET_PROPERTIES(${BASENAME} PROPERTIES PREFIX "")
IF(NOT(WIN32))
    SET_TARGET_PROPERTIES(${BASENAME} PROPERTIES
                          INSTALL_RPATH ${ELMERSOLVER_RPATH_STRING})
ENDIF()

INSTALL(TARGETS ${BASENAME} LIBRARY DESTINATION "share/elmersolver/lib"
            RUNTIME DESTINATION "share/elmersolver/lib")
